---
title: "Questions about FXTAS Sequence Data"
format:
  html:
    toc: true
    toc-depth: 4
    toc-float: true
    number-sections: true
    embed-resources: true
  docx:
    number-sections: true
---

```{r, include = FALSE}

knitr::opts_chunk$set(
  collapse = TRUE,
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  comment = "#>",
  fig.width = 7.5,
  fig.height = 4
)

# update 'asis' chunk to allow inline code
knitr::knit_engines$set(asis = function(options) {
  if (options$echo && options$eval) knitr::knit_child(text = options$code)
})
```

```{r setup}
#| message: false
library(fxtas)
devtools::load_all()
library(pander)
library(table1)
library(dplyr)
library(magrittr)
NA.label1 = "Missing"
column_var = "Recruited in study phase"
column_var = "FX**"
# load_all()

phase <- ifelse(column_var == "Recruited in study phase", TRUE, FALSE)
cgg <- ifelse(column_var == "FX**", TRUE, FALSE)
```

# General data processing notes

## Missing codes

The missing codes 777, 888, and 999 were converted to `NA` for all variables, unless noted otherwise below.

## Age of onset

In the RedCap database, the "age of onset" variables were recorded using a mix of precise ages and decade-long ranges (for example, "`130`" = "teens", "`200`" = "twenties", etc.). For analysis as numeric variables, the decade codes were replaced by their midpoints (for example, "`130`" was replaced with 15, "`200`" with 25, etc.). The exception is code "`555`" = "lifelong", which was replaced by the minimum of 10 years and the smallest observed value for that age-of-onset variable; for example, if the smallest observed value for "age of tremor onset" was 8, then "`555`" would be replaced by 9. If the smallest observed value were 11, then "`555`" would be replaced by 10.

# Data from first visits

```{asis, echo=phase}
Here, we review the data from the first visits by each participant, stratified by 
the first study phase in which the participant enrolled (GP3 vs GP4).
```

```{asis, echo=cgg}
Here, we review the data from the first visits by each participant, stratified by CGG (`r paste0("<55 or", " \u2265", "55")`).
```

## Tremors


```{r}
vars = c(
  
  "Intention tremor",
  "Resting tremor",
  "Postural tremor",
  "Intermittent tremor",
  "Any tremor (excluding Head Tremor)"
  # "Tremor: Age of onset"
  # "Tremor: Age of onset: missingness reasons"
)
table1(
  NA.label = NA.label1,
  stratified_formula(vars, column_var),
  # render.continuous = c(.="N", .="Mean (SD)", .="Median [Min,  Max]"),
  data = visit1)

```

<br>

Age of onset and missingness reasons where any of the four above tremor types = "Yes":

```{r}
vars = c(
  "Tremor: Age of onset",
  "Tremor: Age of onset: missingness reasons"
)

footnote <- paste0(
  "Age of onset for those with 'Some tremors recorded'."
)

table1(
  NA.label = NA.label1,
  stratified_formula(vars, column_var),
  # render.continuous = c(.="N", .="Mean (SD)", .="Median [Min,  Max]"),
  data = visit1 |> 
    filter(`Any tremor (excluding Head Tremor)` == "Some tremors recorded"),
  footnote = footnote)
```

<br>

```{r}
n_Tremor_noAge <- visit1 |>
  filter(`Any tremor (excluding Head Tremor)` == "Some tremors recorded" &
           is.na(`Tremor: Age of onset`)) |>
  nrow()
```

The `r n_Tremor_noAge` patients with a recorded tremor but missing age of onset are listed below:

<b>The list can be downloaded to `csv` or `excel` by clicking on the `Download` button at the top of the table.</b>

```{r}
display_DT(
  data = visit1 |>
    filter(`Any tremor (excluding Head Tremor)` == "Some tremors recorded" &
             is.na(`Tremor: Age of onset`)) |>
    dplyr::select(`FXS ID`, `Event Name`, `Any tremor (excluding Head Tremor)`,
                  `Tremor: Age of onset`),
  filename = "GP3_GP4_Tremor_Age-of-Onset_Missing",
  group = FALSE
)
```

<br>

Do we have age of onset for those with 'No tremors recorded' or missing data?

```{r}
vars = c(
  "Tremor: Age of onset"
)

footnote <- paste0(
  "Age of onset for those with 'No tremors recorded' or missing data."
)

table1(
  NA.label = NA.label1,
  stratified_formula(vars, column_var),
  # render.continuous = c(.="N", .="Mean (SD)", .="Median [Min,  Max]"),
  data = visit1 |> 
    filter(`Any tremor (excluding Head Tremor)` == "No tremors recorded" |
             is.na(`Any tremor (excluding Head Tremor)`)),
  footnote = footnote)
```

```{r}
# store number
n_age_NoTremor <- visit1 |> 
  filter((is.na(`Any tremor (excluding Head Tremor)`) | 
            `Any tremor (excluding Head Tremor)` == "No tremors recorded") & 
           !is.na(`Tremor: Age of onset`)) |> 
  nrow()
```

The `r n_age_NoTremor` patients with Age of Onset without having any tremor recorded are listed below.

<b>The list can be downloaded to `csv` or `excel` by clicking on the `Download` button at the top of the table.</b>

```{r}
display_DT(
  data = gp34 |> 
    filter((is.na(`Any tremor (excluding Head Tremor)`) | 
            `Any tremor (excluding Head Tremor)` == "No tremors recorded") &
           !is.na(`Tremor: Age of onset`)) |> 
  dplyr::select(`FXS ID`, `Event Name`, `Any tremor (excluding Head Tremor)`, 
                `Tremor: Age of onset`),
  filename = "GP3_GP4_No-Tremor_Age-of-Onset",
  group = FALSE
)
```

## Head tremors

Unfortunately, head tremor was not collected in GP3.   

```{r}
vars = c(
  "Head tremor"
  # "Head Tremor: Age of onset"
  
)

footnote <- paste0(
  "Head tremor was not collected in GP3. Summaries provided are for GP4 only."
)

table1(
  NA.label = NA.label1,
  stratified_formula(vars, column_var),
  # render.continuous = c(.="N", .="Mean (SD)", .="Median [Min,  Max]"),
  data = visit1 |> filter(Study == "GP4"),
  footnote = footnote)

```

<br>

Age of onset and missingness reasons where "Head tremor" = "Yes":

```{r}
vars = c(
  "Head Tremor: Age of onset",
  "Head Tremor: Age of onset: missingness reasons"
  
)

footnote <- paste0(
  "Age of onset for those with a head tremor recorded."
)

table1(
  NA.label = NA.label1,
  stratified_formula(vars, column_var),
  # render.continuous = c(.="N", .="Mean (SD)", .="Median [Min,  Max]"),
  data = visit1 |> filter(Study == "GP4" & `Head tremor` == "Yes"),
  footnote = footnote)

```

```{r}
n_noAge_HeadTremor <- visit1 |> 
  filter(
    Study == "GP4" & 
      `Head tremor` == "Yes" & 
      is.na(`Head Tremor: Age of onset`)
  ) |>
  nrow()
```

The `r n_noAge_HeadTremor` patients with missing age of onset that have a head tremor are listed below:

<b>The list can be downloaded to `csv` or `excel` by clicking on the `Download` button at the top of the table.</b>

```{r}
display_DT(
  data = visit1 |> 
  filter(
    Study == "GP4" & 
      `Head tremor` == "Yes" & 
      is.na(`Head Tremor: Age of onset`)
  ) |>
    dplyr::select(`FXS ID`, `Event Name`, `Head tremor`, 
                  `Head Tremor: Age of onset`),
  filename = "GP4_HeadTremor_Missing_Age-of-Onset",
  group = FALSE
)
```

Do we have age of onset for those with 'No' head tremor or missing data?  

```{r}
# store n for text
n_age_NoHeadTremor <- visit1 |> 
    filter((`Head tremor` == "No" |
             is.na(`Head tremor`)) & 
             Study == "GP4" &
             !is.na(`Head Tremor: Age of onset`)) |>
  nrow()
```

There are `r n_age_NoHeadTremor` patients with age of onset without having a Head tremor.

```{r}
vars = c(
  "Head Tremor: Age of onset"
)

footnote <- paste0(
  "Age of onset for those with 'No' head tremor or missing data."
)

table1(
  NA.label = NA.label1,
  stratified_formula(vars, column_var),
  # render.continuous = c(.="N", .="Mean (SD)", .="Median [Min,  Max]"),
  data = visit1 |> 
    filter((`Head tremor` == "No" |
             is.na(`Head tremor`)) & 
             Study == "GP4"),
  footnote = footnote)
```


## Ataxia


```{r}

vars = c(
  "Ataxia",
  "Ataxia: severity",
  "Ataxia: severity*"
  # "Ataxia: Age of onset",
  # "Ataxia: Age of onset: missingness reasons"
)

table1(
  NA.label = NA.label1,
  stratified_formula(vars, column_var),
  # render.continuous = c(.="N", .="Mean (SD)", .="Median [Min,  Max]"),
  data = visit1)

```

<br>

Age of onset and missingness reasons where "Ataxia" = "Yes":

```{r}
vars = c(
  # "Ataxia",
  # "Ataxia: severity",
  # "Ataxia: severity*"
  "Ataxia: Age of onset",
  "Ataxia: Age of onset: missingness reasons"
)

table1(
  NA.label = NA.label1,
  stratified_formula(vars, column_var),
  # render.continuous = c(.="N", .="Mean (SD)", .="Median [Min,  Max]"),
  data = visit1 |> filter(Ataxia == "Yes"))
```

```{r}
n_Ataxia_noAge <- visit1 |>
  filter(
    Ataxia == "Yes" & is.na(`Ataxia: Age of onset`)
  ) |>
  nrow()
```

<br>

The `r n_Ataxia_noAge` patients with Ataxia but are missing age of onset are listed below:  

<b>The list can be downloaded to `csv` or `excel` by clicking on the `Download` button at the top of the table.</b>

```{r}
display_DT(
  data = visit1 |>
    filter(
      Ataxia == "Yes" & is.na(`Ataxia: Age of onset`)
    ) |>
    dplyr::select(`FXS ID`, `Event Name`, Ataxia, `Ataxia: Age of onset`),
  filename = "GP3_GP4_Ataxia_Age-of-Onset_Missing",
  group = FALSE
)
```

<br>

```{r}
# store n for text
n_age_NoAtaxia <- visit1 |> 
    filter((Ataxia == "No" |
             is.na(Ataxia)) & 
             !is.na(`Ataxia: Age of onset`)) |>
  nrow()
```

Do we have age of onset for those with 'No' Ataxia or missing data?  

```{r}
vars = c(
  # "Ataxia",
  # "Ataxia: severity",
  # "Ataxia: severity*"
  "Ataxia: Age of onset",
  "Ataxia: Age of onset: missingness reasons"
)

footnote = paste0(
  "Age of onset for those with 'No' Ataxia or missing data."
)

table1(
  NA.label = NA.label1,
  stratified_formula(vars, column_var),
  # render.continuous = c(.="N", .="Mean (SD)", .="Median [Min,  Max]"),
  footnote = footnote,
  data = visit1 |> filter(Ataxia == "No" | is.na(Ataxia))
)
```

There are `r n_age_NoAtaxia` patients with age of onset without having Ataxia. These records are listed below.  

<b>The list can be downloaded to `csv` or `excel` by clicking on the `Download` button at the top of the table.</b>

```{r}
display_DT(
  data = visit1 |> 
    filter((Ataxia == "No" |
               is.na(Ataxia)) & 
               !is.na(`Ataxia: Age of onset`)) |> 
    dplyr::select(`FXS ID`, `Event Name`, Ataxia, 
                  `Ataxia: Age of onset`),
  filename = "GP3_GP4_No-Ataxia_Age-of-Onset",
  group = FALSE
)
```

