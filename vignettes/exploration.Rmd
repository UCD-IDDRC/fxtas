---
title: "exploration"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{exploration}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(fxtas)
```

## plotly

```{r}

library(plotly)
library(dplyr)
gp34 |> 
  nest_by(Study) |> 
  mutate(
    p = 
      plot_ly(data,
              type = "scatter",
              mode = "lines+markers",
              color = ~`FXS ID`,
              x = ~`Event Name`,
              y = ~`Age at visit`,
              showlegend = FALSE
      ) |> 
      plotly::layout(
        xaxis = list(title = "")
        # title = "banana"
      ) |> 
      list()
  ) |> 
  pull(p) |> 
  plotly::subplot(
    nrows = 1, shareX = TRUE, shareY = TRUE)

```

## ggplot

```{r}

library(ggplot2)

plot1 = gp34 |> 
  ggplot(
    data = _,
    mapping = aes(
      color = `FXS ID`,
      group = `FXS ID`,
      y = `Event Name`,
      x = `Age at visit`
    )) +
  geom_point() + 
  geom_line() +
  theme_bw() +
  facet_grid(rows = vars(Gender)) +
  theme(legend.position="none")

print(plot1)

plot1 |> plotly::ggplotly()


```

## demographics

```{r}

pts = 
  gp34 |> 
  arrange(
    `Age at visit`
  ) |> 
  group_by(`FXS ID`) |> 
  slice_head(n = 1) |>
  rename(
    `Age at first visit` = `Age at visit`,
    `Recruited in study phase` = Study
  ) |> 
  left_join(
    gp34 |> count(`FXS ID`, name = "# visits"),
    by = "FXS ID"
  ) |> 
  mutate(`# visits` = factor(`# visits`, levels = 1:6))


```


## Table 1
```{r}

vars = c(
  "Age at first visit",
  "# visits",
  "Recruited in study phase",
  "Primary Ethnicity",
  "Primary Race",
  "ApoE",
  # "Floras Non-Sortable Allele Size (CGG) Results", # too many levels
  "Drug use",
  "Marijuana use",
  "Alcohol use"
  # "# of drinks per day now"
  # "Thyroid Cancer",
  
)

library(table1)
table1(
  formula(paste("~", paste(formulaic::add.backtick(vars), collapse = " + "), "| Gender")),
  data = pts)
```

