```{r}
fig_females_all = extract_figs_from_pickle(
  n_s = 1,
  rda_filename = "gp34_longitudinal.RData",
  dataset_name = "females",
  output_folder = "output/gp34_longitudinal")

fig_females_mv_only = extract_figs_from_pickle(
  n_s = 1,
  rda_filename = "gp34_multivisit_only.RData",
  dataset_name = "females",
  output_folder = "output/gp34_multivisit_only")


fig_males_all = extract_figs_from_pickle(
  n_s = 1,
  rda_filename = "gp34_longitudinal.RData",
  dataset_name = "males",
  output_folder = "output/gp34_longitudinal")

fig_males_mv_only = extract_figs_from_pickle(
  n_s = 1,
  rda_filename = "gp34_multivisit_only.RData",
  dataset_name = "males",
  output_folder = "output/gp34_multivisit_only")


fig_both_all = extract_figs_from_pickle(
  n_s = 1,
  rda_filename = "gp34_longitudinal.RData",
  dataset_name = "gp34_longitudinal",
  output_folder = "output/gp34_longitudinal")

fig_both_mv_only = extract_figs_from_pickle(
  n_s = 1,
  rda_filename = "gp34_multivisit_only.RData",
  dataset_name = "gp34_multivisit_only",
  output_folder = "output/gp34_multivisit_only")

```

## Results with repeated measures

### Males

@fig-males shows estimated event sequences for males, depending on which subset of the data we use to fit the model.

```{r}
#| label: "fig-males"
#| column: screen
#| fig-height: 15
#| fig-align: center
#| fig-cap: "Estimated event sequences for males, by data subset"
#| fig-cap-location: top
#| layout-ncol: 3
#| fig-subcap:
#|   - "First visits only"
#|   - "All visits" 
#|   - "Multivisit patients only"

fig_males_first |> print()

fig_males_all |> print()

fig_males_mv_only |> print()

```

### Females

```{r}
#| label: "fig-females"
#| fig-cap: "Estimated event sequences for females, by data subset"
#| column: screen
#| fig-height: 15
#| fig-align: center
#| fig-cap-location: top
#| layout-ncol: 3
#| fig-subcap:
#|   - "First visits only"
#|   - "All visits" 
#|   - "Multivisit patients only"

fig_females_first |> print()

fig_females_all |> print()

fig_females_mv_only |> print()

```


### Unstratified, by data subset

```{r}
#| label: "fig-both-genders"
#| column: screen
#| fig-height: 15
#| fig-align: center
#| fig-cap: "Estimated event sequences, unstratified, by data subset"
#| fig-cap-location: top
#| layout-ncol: 3
#| fig-subcap:
#|   - "First visits only"
#|   - "All visits" 
#|   - "Multivisit patients only"

fig_both_first |> print()
fig_both_all |> print()
fig_both_mv_only |> print()

```



### All patients, all visits

@fig-all-visits shows the event sequences that we estimated from each data subset. Note that clinical events which never occur in a dataset cannot be placed into the event sequence, so the set of modeled events varies by data subset.

We note that Parkinsonian features mostly appear after FXTAS stage 4 for females, whereas they occur before stage 4 for males.

Similarly, clinically-elevated SCL90 values appear before FXTAS stage 1 for females, whereas they occur after stage 3 for males.


```{r}
#| label: "fig-all-visits"
#| column: screen
#| fig-height: 15
#| fig-align: center
#| fig-cap: "Estimated event sequences - all visits"
#| fig-cap-location: top
#| layout-ncol: 3
#| fig-subcap:
#|   - "Unstratified"
#|   - "Males only" 
#|   - "Females only"

fig_both_all |> print()
fig_males_all |> print()
fig_females_all |> print()

```

```{r}
#| label: fig-stage-by-age-longitudinal
#| fig-cap: "ML stage by age, longitudinal data"
#| include: false
stages = 
  results_cv_max$subtype_and_stage_table |> 
  mutate(
    age = patient_data$`Age at first visit`
  )

library(ggplot2)
stages |>
  graph_stage_by_age()


```

### Multivisit patients only, all visits

@fig-mv-only shows the event sequences that we estimated using only the data from patients with more than one visit.

```{r}
#| label: "fig-mv-only"
#| column: screen
#| fig-height: 15
#| fig-align: center
#| fig-cap: "Estimated event sequences - multivisit patients only"
#| fig-cap-location: top
#| layout-ncol: 3
#| fig-subcap:
#|   - "Unstratified"
#|   - "Males only" 
#|   - "Females only"

fig_both_mv_only |> print()
fig_males_mv_only |> print()
fig_females_mv_only |> print()

```


