---
title: "Modeling longitudinal data"
knitr:
  opts_chunk: 
    collapse: true
    comment: "#>" 
    R.options:  
      dev: svg

project:
  execute-dir: project
---

```{=html}
<style>
.quarto-figure-center > figure {
text-align: center;
}
</style>
```

# Methods

Here, we fit the Ordinal SuStaIn model [@young2021ordinal] on six subsets of the data:

- All patients (@fig-pvd1-1)
- Males only (@fig-pvd1-2)
- Females only (@fig-pvd1-3)
- All patients with multiple visits (@fig-pvd2-1)
- Males with multiple visits (@fig-pvd2-2)
- Females with multiple visits (@fig-pvd2-3)

For each of these patient subgroups, we included all longitudinal visits.

```{r}
#| label: setup
#| include: false

knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  # fig.width = 7, 
  # fig.height = 10,
  include = TRUE
)

devtools::load_all()
# library(fxtas)
library(tidyverse)
library(pander)
```

# Results

## All patients, all visits

@fig-pvd1 shows the event sequences that we estimated from each data subset. Note that clinical events which never occur in a dataset cannot be placed into the event sequence, so the set of modeled events varies by data subset.

```{r}
#| label: "fig-pvd1"
#| column: screen
#| fig-height: 15
#| fig-align: center
#| fig-cap: "Estimated event sequences - all visits"
#| fig-cap-location: top
#| layout-ncol: 3
#| fig-subcap:
#|   - "All data"
#|   - "Males only" 
#|   - "Females only"

output_folder1 = "output/gp34_longitudinal"
rda_filename1 = "gp34_longitudinal.RData"
fig_all = extract_figs_from_pickle(
  n_s = 1,
  rda_filename = rda_filename1,
  dataset_name = "gp34_longitudinal",
  output_folder = output_folder1)

fig_males = extract_figs_from_pickle(
  n_s = 1,
  rda_filename = rda_filename1,
  dataset_name = "males",
  output_folder = output_folder1)

fig_females = extract_figs_from_pickle(
  n_s = 1,
  rda_filename = rda_filename1,
  dataset_name = "females",
  output_folder = output_folder1)

fig_all |> print()

fig_males |> print()

fig_females |> print()

```

## Multivisit patients only, all visits

@fig-pvd2 shows the event sequences that we estimated using only the data from patients with more than one visit.

```{r}
#| label: "fig-pvd2"
#| column: screen
#| fig-height: 15
#| fig-align: center
#| fig-cap: "Estimated event sequences - multivisit patients only"
#| fig-cap-location: top
#| layout-ncol: 3
#| fig-subcap:
#|   - "All data"
#|   - "Males only" 
#|   - "Females only"

output_folder_mv_only = "output/gp34_multivisit_only"
rda_filename_mv_only = "gp34_multivisit_only.RData"

fig_all_mv_only = extract_figs_from_pickle(
  n_s = 1,
  rda_filename = rda_filename_mv_only,
  dataset_name = "gp34_multivisit_only",
  output_folder = output_folder_mv_only)

fig_males_mv_only = extract_figs_from_pickle(
  n_s = 1,
  rda_filename = rda_filename_mv_only,
  dataset_name = "males",
  output_folder = output_folder_mv_only)

fig_females_mv_only = extract_figs_from_pickle(
  n_s = 1,
  rda_filename = rda_filename_mv_only,
  dataset_name = "females",
  output_folder = output_folder_mv_only)

fig_all_mv_only |> print()

fig_males_mv_only |> print()

fig_females_mv_only |> print()

```

# References {.unnumbered}

::: {#refs}
:::
